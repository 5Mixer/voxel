// Generated by HLC 4.1.3 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <kha/KravurImage.h>
#include <kha/internal/BytesBlob.h>
#include <kha/graphics2/truetype/Stbtt_bakedchar.h>
#include <haxe/io/Bytes.h>
extern hl_type t$_i32;
kha__Image kha_Image_create(int,int,vdynamic*,vdynamic*);
haxe__io__Bytes kha_Image_lock(kha__Image,int*);
int kha_internal_BytesBlob_readU8(kha__internal__BytesBlob,int);
void haxe_io_Bytes_set(haxe__io__Bytes,int,int);
void kha_Image_unlock(kha__Image);
#include <kha/AlignedQuad.h>
#include <hl/natives.h>
extern kha__$KravurImage g$_kha_KravurImage;
vdynamic* String_charCodeAt(String,int);

void kha_KravurImage_new(kha__KravurImage r0,int r1,int r2,int r3,int r4,int r5,int r6,hl__types__ArrayObj r7,kha__internal__BytesBlob r8) {
	kha__Image r18;
	haxe__io__Bytes r21;
	kha__graphics2__truetype__Stbtt_bakedchar r14;
	double r10, r17;
	int *r22;
	vdynamic *r15, *r19, *r20;
	varray *r16;
	int r9, r12, r13, r23, r24, r25;
	r10 = (double)r1;
	r0->mySize = r10;
	r0->width = r5;
	r0->height = r6;
	r0->chars = r7;
	r10 = (double)r2;
	r0->baseline = r10;
	r9 = 0;
	label$5871e49_1_8:
	if( r7 == NULL ) hl_null_access();
	r13 = r7->length;
	if( r9 >= r13 ) goto label$5871e49_1_26;
	r13 = r7->length;
	if( ((unsigned)r9) < ((unsigned)r13) ) goto label$5871e49_1_16;
	r14 = NULL;
	goto label$5871e49_1_19;
	label$5871e49_1_16:
	r16 = r7->array;
	r15 = ((vdynamic**)(r16 + 1))[r9];
	r14 = (kha__graphics2__truetype__Stbtt_bakedchar)r15;
	label$5871e49_1_19:
	++r9;
	if( r14 == NULL ) hl_null_access();
	r10 = r14->yoff;
	r17 = r0->baseline;
	r10 = r10 + r17;
	r14->yoff = r10;
	goto label$5871e49_1_8;
	label$5871e49_1_26:
	r13 = 1;
	r19 = hl_alloc_dynamic(&t$_i32);
	r19->v.i = r13;
	r20 = NULL;
	r18 = kha_Image_create(r5,r6,r19,r20);
	r0->texture = r18;
	r18 = r0->texture;
	if( r18 == NULL ) hl_null_access();
	r22 = NULL;
	r21 = kha_Image_lock(r18,r22);
	r9 = 0;
	r12 = 0;
	r13 = r6;
	label$5871e49_1_38:
	if( r12 >= r13 ) goto label$5871e49_1_53;
	++r12;
	r23 = 0;
	r24 = r5;
	label$5871e49_1_43:
	if( r23 >= r24 ) goto label$5871e49_1_52;
	++r23;
	if( r21 == NULL ) hl_null_access();
	if( r8 == NULL ) hl_null_access();
	r25 = kha_internal_BytesBlob_readU8(r8,r9);
	haxe_io_Bytes_set(r21,r9,r25);
	++r9;
	goto label$5871e49_1_43;
	label$5871e49_1_52:
	goto label$5871e49_1_38;
	label$5871e49_1_53:
	r18 = r0->texture;
	if( r18 == NULL ) hl_null_access();
	kha_Image_unlock(r18);
	return;
}

kha__Image kha_KravurImage_getTexture(kha__KravurImage r0) {
	kha__Image r1;
	r1 = r0->texture;
	return r1;
}

kha__AlignedQuad kha_KravurImage_getBakedQuad(kha__KravurImage r0,kha__AlignedQuad r1,int r2,double r3,double r4) {
	hl__types__ArrayObj r7;
	kha__AlignedQuad r8;
	kha__graphics2__truetype__Stbtt_bakedchar r13;
	double r10, r11, r12, r15;
	vdynamic *r9;
	varray *r14;
	int r5, r6, r16, r17;
	r7 = r0->chars;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->length;
	if( r2 < r6 ) goto label$5871e49_3_6;
	r8 = NULL;
	return r8;
	label$5871e49_3_6:
	r10 = 1.;
	r5 = r0->width;
	r11 = (double)r5;
	r10 = r10 / r11;
	r11 = 1.;
	r5 = r0->height;
	r12 = (double)r5;
	r11 = r11 / r12;
	r7 = r0->chars;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->length;
	if( ((unsigned)r2) < ((unsigned)r6) ) goto label$5871e49_3_20;
	r13 = NULL;
	goto label$5871e49_3_23;
	label$5871e49_3_20:
	r14 = r7->array;
	r9 = ((vdynamic**)(r14 + 1))[r2];
	r13 = (kha__graphics2__truetype__Stbtt_bakedchar)r9;
	label$5871e49_3_23:
	if( r13 ) goto label$5871e49_3_26;
	r8 = NULL;
	return r8;
	label$5871e49_3_26:
	if( r13 == NULL ) hl_null_access();
	r15 = r13->xoff;
	r12 = r3 + r15;
	r5 = hl_math_round(r12);
	r15 = r13->yoff;
	r12 = r4 + r15;
	r6 = hl_math_round(r12);
	if( r1 == NULL ) hl_null_access();
	r12 = (double)r5;
	r1->x0 = r12;
	r12 = (double)r6;
	r1->y0 = r12;
	r17 = r13->x1;
	r16 = r5 + r17;
	r17 = r13->x0;
	r16 = r16 - r17;
	r12 = (double)r16;
	r1->x1 = r12;
	r17 = r13->y1;
	r16 = r6 + r17;
	r17 = r13->y0;
	r16 = r16 - r17;
	r12 = (double)r16;
	r1->y1 = r12;
	r16 = r13->x0;
	r12 = (double)r16;
	r12 = r12 * r10;
	r1->s0 = r12;
	r16 = r13->y0;
	r12 = (double)r16;
	r12 = r12 * r11;
	r1->t0 = r12;
	r16 = r13->x1;
	r12 = (double)r16;
	r12 = r12 * r10;
	r1->s1 = r12;
	r16 = r13->y1;
	r12 = (double)r16;
	r12 = r12 * r11;
	r1->t1 = r12;
	r12 = r13->xadvance;
	r1->xadvance = r12;
	return r1;
}

double kha_KravurImage_getCharWidth(kha__KravurImage r0,int r1) {
	kha__$KravurImage r8;
	hl__types__ArrayObj r3;
	hl__types__ArrayBytes_Int r7;
	kha__graphics2__truetype__Stbtt_bakedchar r11;
	double r5, r13;
	vdynamic *r6;
	varray *r12;
	vbyte *r9;
	int r2, r4, r10, r14, r15, r16, r17, r18, r19;
	r3 = r0->chars;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->length;
	r4 = 0;
	if( r2 != r4 ) goto label$5871e49_4_7;
	r5 = 0.;
	return r5;
	label$5871e49_4_7:
	r8 = (kha__$KravurImage)g$_kha_KravurImage;
	r7 = r8->charBlocks;
	if( r7 == NULL ) hl_null_access();
	r2 = 0;
	r4 = r7->length;
	if( ((unsigned)r2) < ((unsigned)r4) ) goto label$5871e49_4_15;
	r2 = 0;
	goto label$5871e49_4_19;
	label$5871e49_4_15:
	r9 = r7->bytes;
	r4 = 2;
	r4 = r2 << r4;
	r2 = *(int*)(r9 + r4);
	label$5871e49_4_19:
	if( r1 >= r2 ) goto label$5871e49_4_33;
	r3 = r0->chars;
	if( r3 == NULL ) hl_null_access();
	r4 = 0;
	r10 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r10) ) goto label$5871e49_4_27;
	r11 = NULL;
	goto label$5871e49_4_30;
	label$5871e49_4_27:
	r12 = r3->array;
	r6 = ((vdynamic**)(r12 + 1))[r4];
	r11 = (kha__graphics2__truetype__Stbtt_bakedchar)r6;
	label$5871e49_4_30:
	if( r11 == NULL ) hl_null_access();
	r5 = r11->xadvance;
	return r5;
	label$5871e49_4_33:
	r4 = 1;
	r8 = (kha__$KravurImage)g$_kha_KravurImage;
	r7 = r8->charBlocks;
	if( r7 == NULL ) hl_null_access();
	r10 = r7->length;
	r5 = (double)r10;
	r13 = 2.;
	r5 = r5 / r13;
	r10 = (int)r5;
	label$5871e49_4_42:
	if( r4 >= r10 ) goto label$5871e49_4_83;
	r14 = r4;
	++r4;
	r8 = (kha__$KravurImage)g$_kha_KravurImage;
	r7 = r8->charBlocks;
	if( r7 == NULL ) hl_null_access();
	r16 = 2;
	r15 = r14 * r16;
	r16 = 1;
	r15 = r15 - r16;
	r16 = r7->length;
	if( ((unsigned)r15) < ((unsigned)r16) ) goto label$5871e49_4_57;
	r15 = 0;
	goto label$5871e49_4_61;
	label$5871e49_4_57:
	r9 = r7->bytes;
	r16 = 2;
	r16 = r15 << r16;
	r15 = *(int*)(r9 + r16);
	label$5871e49_4_61:
	r8 = (kha__$KravurImage)g$_kha_KravurImage;
	r7 = r8->charBlocks;
	if( r7 == NULL ) hl_null_access();
	r17 = 2;
	r16 = r14 * r17;
	r17 = r7->length;
	if( ((unsigned)r16) < ((unsigned)r17) ) goto label$5871e49_4_70;
	r16 = 0;
	goto label$5871e49_4_74;
	label$5871e49_4_70:
	r9 = r7->bytes;
	r17 = 2;
	r17 = r16 << r17;
	r16 = *(int*)(r9 + r17);
	label$5871e49_4_74:
	r19 = 1;
	r18 = r16 - r19;
	if( r18 >= r1 ) goto label$5871e49_4_82;
	r19 = 1;
	r18 = r16 - r19;
	r18 = r18 - r15;
	r17 = r2 + r18;
	r2 = r17;
	label$5871e49_4_82:
	goto label$5871e49_4_42;
	label$5871e49_4_83:
	r4 = r1 - r2;
	r3 = r0->chars;
	if( r3 == NULL ) hl_null_access();
	r10 = r3->length;
	if( r4 < r10 ) goto label$5871e49_4_101;
	r3 = r0->chars;
	if( r3 == NULL ) hl_null_access();
	r4 = 0;
	r10 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r10) ) goto label$5871e49_4_95;
	r11 = NULL;
	goto label$5871e49_4_98;
	label$5871e49_4_95:
	r12 = r3->array;
	r6 = ((vdynamic**)(r12 + 1))[r4];
	r11 = (kha__graphics2__truetype__Stbtt_bakedchar)r6;
	label$5871e49_4_98:
	if( r11 == NULL ) hl_null_access();
	r5 = r11->xadvance;
	return r5;
	label$5871e49_4_101:
	r3 = r0->chars;
	if( r3 == NULL ) hl_null_access();
	r4 = r1 - r2;
	r10 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r10) ) goto label$5871e49_4_108;
	r11 = NULL;
	goto label$5871e49_4_111;
	label$5871e49_4_108:
	r12 = r3->array;
	r6 = ((vdynamic**)(r12 + 1))[r4];
	r11 = (kha__graphics2__truetype__Stbtt_bakedchar)r6;
	label$5871e49_4_111:
	if( r11 == NULL ) hl_null_access();
	r5 = r11->xadvance;
	return r5;
}

double kha_KravurImage_getHeight(kha__KravurImage r0) {
	double r1;
	r1 = r0->mySize;
	return r1;
}

double kha_KravurImage_stringWidth(kha__KravurImage r0,String r1) {
	double r2, r7, r8;
	vdynamic *r9;
	int r3, r4, r5, r6;
	r2 = 0.;
	r3 = 0;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->length;
	label$5871e49_6_4:
	if( r3 >= r4 ) goto label$5871e49_6_15;
	r5 = r3;
	++r3;
	if( r1 == NULL ) hl_null_access();
	r9 = String_charCodeAt(r1,r5);
	r6 = r9 ? r9->v.i : 0;
	r8 = kha_KravurImage_getCharWidth(r0,r6);
	r7 = r2 + r8;
	r2 = r7;
	goto label$5871e49_6_4;
	label$5871e49_6_15:
	return r2;
}

double kha_KravurImage_charactersWidth(kha__KravurImage r0,hl__types__ArrayBytes_Int r1,int r2,int r3) {
	double r4, r9, r10;
	vbyte *r12;
	int r5, r6, r7, r8, r11;
	r4 = 0.;
	r5 = r2;
	r6 = r2 + r3;
	label$5871e49_7_3:
	if( r5 >= r6 ) goto label$5871e49_7_20;
	r7 = r5;
	++r5;
	if( r1 == NULL ) hl_null_access();
	r11 = r1->length;
	if( ((unsigned)r7) < ((unsigned)r11) ) goto label$5871e49_7_12;
	r8 = 0;
	goto label$5871e49_7_16;
	label$5871e49_7_12:
	r12 = r1->bytes;
	r11 = 2;
	r11 = r7 << r11;
	r8 = *(int*)(r12 + r11);
	label$5871e49_7_16:
	r10 = kha_KravurImage_getCharWidth(r0,r8);
	r9 = r4 + r10;
	r4 = r9;
	goto label$5871e49_7_3;
	label$5871e49_7_20:
	return r4;
}

double kha_KravurImage_getBaselinePosition(kha__KravurImage r0) {
	double r1;
	r1 = r0->baseline;
	return r1;
}

