// Generated by HLC 4.1.3 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <kha/audio2/ogg/vorbis/Reader.h>
void kha_audio2_ogg_vorbis_VorbisDecoder_seek(kha__audio2__ogg__vorbis__VorbisDecoder,vclosure*,int,int);
#include <hl/natives.h>
#include <haxe/io/Input.h>
#include <kha/audio2/ogg/vorbis/data/Comment.h>
kha__audio2__ogg__vorbis__VorbisDecoder kha_audio2_ogg_vorbis_VorbisDecoder_start(haxe__io__Input);
void kha_audio2_ogg_vorbis_VorbisDecoder_setupSampleNumber(kha__audio2__ogg__vorbis__VorbisDecoder,vclosure*,int);
vdynamic* kha_audio2_ogg_vorbis_data_Comment_get_loopStart(kha__audio2__ogg__vorbis__data__Comment);
vdynamic* kha_audio2_ogg_vorbis_data_Comment_get_loopLength(kha__audio2__ogg__vorbis__data__Comment);
void kha_audio2_ogg_vorbis_Reader_seekBytes(haxe__io__BytesInput,int);
extern hl_type t$haxe_io_BytesInput;
void haxe_io_BytesInput_new(haxe__io__BytesInput,haxe__io__Bytes,vdynamic*,vdynamic*);
extern hl_type t$kha_audio2_ogg_vorbis_Reader;
extern hl_type t$fun_d8cbd66;
int haxe_io_BytesInput_set_position(haxe__io__BytesInput,int);
#include <sys/io/FileInput.h>
#include <_std/Date.h>
sys__io__FileInput sys_io_File_read(String,bool*);
vvirtual* sys_FileSystem_stat(String);
void sys_io_FileInput_seek(sys__io__FileInput,int,venum*);
extern hl_type t$fun_7ec7bf9;
extern venum* g$sys_io_FileSeek_SeekBegin;
extern hl_type t$ctx_8d10a28;
extern hl_type t$fun_27a3c24;
extern hl_type t$_i32;
#include <kha/arrays/Float32ArrayPrivate.h>
extern hl_type t$kha_arrays_Float32ArrayPrivate;
void kha_arrays_Float32ArrayPrivate_new(kha__arrays__Float32ArrayPrivate);
int kha_audio2_ogg_vorbis_VorbisDecoder_read(kha__audio2__ogg__vorbis__VorbisDecoder,kha__arrays__Float32ArrayPrivate,int,int,int,bool);
void haxe_io_Output_writeFloat(haxe__io__Output,double);
void kha_audio2_ogg_vorbis_VorbisDecoder_ensurePosition(kha__audio2__ogg__vorbis__VorbisDecoder,vclosure*);
extern kha__audio2__ogg__vorbis__$Reader g$_kha_audio2_ogg_vorbis_Reader;
vdynamic* Type_createEmptyInstance(hl__Class);
extern hl_type t$_dyn;
kha__audio2__ogg__vorbis__VorbisDecoder kha_audio2_ogg_vorbis_VorbisDecoder_clone(kha__audio2__ogg__vorbis__VorbisDecoder,vclosure*);

kha__audio2__ogg__vorbis__data__Header kha_audio2_ogg_vorbis_Reader_get_header(kha__audio2__ogg__vorbis__Reader r0) {
	kha__audio2__ogg__vorbis__VorbisDecoder r2;
	kha__audio2__ogg__vorbis__data__Header r1;
	r2 = r0->decoder;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->header;
	return r1;
}

int kha_audio2_ogg_vorbis_Reader_get_totalSample(kha__audio2__ogg__vorbis__Reader r0) {
	kha__audio2__ogg__vorbis__VorbisDecoder r2;
	vdynamic *r1;
	int r3;
	r2 = r0->decoder;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->totalSample;
	r3 = r1 ? r1->v.i : 0;
	return r3;
}

double kha_audio2_ogg_vorbis_Reader_get_totalMillisecond(kha__audio2__ogg__vorbis__Reader r0) {
	kha__audio2__ogg__vorbis__VorbisDecoder r3;
	kha__audio2__ogg__vorbis__data__Header r5;
	double r1, r6;
	vdynamic *r2;
	int r4;
	r3 = r0->decoder;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->totalSample;
	r4 = r2 ? r2->v.i : 0;
	r1 = (double)(unsigned)r4;
	r5 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r5 == NULL ) hl_null_access();
	r4 = r5->sampleRate;
	r6 = (double)(unsigned)r4;
	r1 = r1 / r6;
	r6 = 1000.;
	r1 = r1 * r6;
	return r1;
}

int kha_audio2_ogg_vorbis_Reader_get_currentSample(kha__audio2__ogg__vorbis__Reader r0) {
	kha__audio2__ogg__vorbis__VorbisDecoder r2;
	int r1;
	r2 = r0->decoder;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->currentSample;
	return r1;
}

int kha_audio2_ogg_vorbis_Reader_set_currentSample(kha__audio2__ogg__vorbis__Reader r0,int r1) {
	kha__audio2__ogg__vorbis__VorbisDecoder r3;
	vclosure *r4;
	int r5;
	r3 = r0->decoder;
	if( r3 == NULL ) hl_null_access();
	r4 = r0->seekFunc;
	r5 = r0->inputLength;
	kha_audio2_ogg_vorbis_VorbisDecoder_seek(r3,r4,r5,r1);
	r3 = r0->decoder;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->currentSample;
	return r5;
}

double kha_audio2_ogg_vorbis_Reader_get_currentMillisecond(kha__audio2__ogg__vorbis__Reader r0) {
	kha__audio2__ogg__vorbis__data__Header r3;
	double r1, r4;
	int r2;
	r2 = kha_audio2_ogg_vorbis_Reader_get_currentSample(r0);
	r1 = (double)(unsigned)r2;
	r3 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r3 == NULL ) hl_null_access();
	r2 = r3->sampleRate;
	r4 = (double)(unsigned)r2;
	r1 = r1 / r4;
	r4 = 1000.;
	r1 = r1 * r4;
	return r1;
}

double kha_audio2_ogg_vorbis_Reader_set_currentMillisecond(kha__audio2__ogg__vorbis__Reader r0,double r1) {
	kha__audio2__ogg__vorbis__data__Header r4;
	double r3, r5, r6;
	int r2;
	r4 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r4 == NULL ) hl_null_access();
	r2 = r4->sampleRate;
	r3 = (double)(unsigned)r2;
	r6 = 1000.;
	r5 = r1 / r6;
	r3 = r3 * r5;
	r2 = hl_math_floor(r3);
	r2 = kha_audio2_ogg_vorbis_Reader_set_currentSample(r0,r2);
	r3 = kha_audio2_ogg_vorbis_Reader_get_currentMillisecond(r0);
	return r3;
}

void kha_audio2_ogg_vorbis_Reader_new(kha__audio2__ogg__vorbis__Reader r0,haxe__io__Input r1,vclosure* r2,int r3) {
	kha__audio2__ogg__vorbis__data__Comment r7;
	kha__audio2__ogg__vorbis__VorbisDecoder r4;
	kha__audio2__ogg__vorbis__data__Header r8;
	vdynamic *r6;
	r0->seekFunc = r2;
	r0->inputLength = r3;
	r4 = kha_audio2_ogg_vorbis_VorbisDecoder_start(r1);
	r0->decoder = r4;
	r4 = r0->decoder;
	if( r4 == NULL ) hl_null_access();
	kha_audio2_ogg_vorbis_VorbisDecoder_setupSampleNumber(r4,r2,r3);
	r8 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r8 == NULL ) hl_null_access();
	r7 = r8->comment;
	if( r7 == NULL ) hl_null_access();
	r6 = kha_audio2_ogg_vorbis_data_Comment_get_loopStart(r7);
	r0->loopStart = r6;
	r8 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r8 == NULL ) hl_null_access();
	r7 = r8->comment;
	if( r7 == NULL ) hl_null_access();
	r6 = kha_audio2_ogg_vorbis_data_Comment_get_loopLength(r7);
	r0->loopLength = r6;
	return;
}

void kha_audio2_ogg_vorbis_Reader_openFromBytes__$1(haxe__io__BytesInput r0,int r1) {
	kha_audio2_ogg_vorbis_Reader_seekBytes(r0,r1);
	return;
}

kha__audio2__ogg__vorbis__Reader kha_audio2_ogg_vorbis_Reader_openFromBytes(haxe__io__Bytes r0) {
	haxe__io__BytesInput r1;
	kha__audio2__ogg__vorbis__Reader r5;
	vclosure *r6;
	vdynamic *r2, *r3;
	int r7;
	r1 = (haxe__io__BytesInput)hl_alloc_obj(&t$haxe_io_BytesInput);
	r2 = NULL;
	r3 = NULL;
	haxe_io_BytesInput_new(r1,r0,r2,r3);
	r5 = (kha__audio2__ogg__vorbis__Reader)hl_alloc_obj(&t$kha_audio2_ogg_vorbis_Reader);
	r6 = hl_alloc_closure_ptr(&t$fun_d8cbd66,kha_audio2_ogg_vorbis_Reader_openFromBytes__$1,r1);
	if( r0 == NULL ) hl_null_access();
	r7 = r0->length;
	kha_audio2_ogg_vorbis_Reader_new(r5,((haxe__io__Input)r1),r6,r7);
	return r5;
}

void kha_audio2_ogg_vorbis_Reader_seekBytes(haxe__io__BytesInput r0,int r1) {
	int r2;
	if( r0 == NULL ) hl_null_access();
	r2 = haxe_io_BytesInput_set_position(r0,r1);
	return;
}

void kha_audio2_ogg_vorbis_Reader_openFromFile__$1(venum* r0,int r1) {
	venum *r4;
	vclosure *r3;
	r3 = ((Enumt$ctx_8d10a28*)r0)->p1;
	if( r3 == NULL ) hl_null_access();
	r4 = ((Enumt$ctx_8d10a28*)r0)->p0;
	r3->hasValue ? ((void (*)(vdynamic*,int,venum*))r3->fun)((vdynamic*)r3->value,r1,r4) : ((void (*)(int,venum*))r3->fun)(r1,r4);
	return;
}

kha__audio2__ogg__vorbis__Reader kha_audio2_ogg_vorbis_Reader_openFromFile(String r0) {
	bool *r3;
	vvirtual *r5;
	venum *r7, *r10;
	bool r2;
	kha__audio2__ogg__vorbis__Reader r8;
	vclosure *r6, *r9;
	int r11;
	sys__io__FileInput r1;
	r2 = true;
	r3 = &r2;
	r1 = sys_io_File_read(r0,r3);
	r5 = sys_FileSystem_stat(r0);
	if( r1 == NULL ) hl_null_access();
	r6 = hl_alloc_closure_ptr(&t$fun_7ec7bf9,sys_io_FileInput_seek,r1);
	r7 = (venum*)g$sys_io_FileSeek_SeekBegin;
	r8 = (kha__audio2__ogg__vorbis__Reader)hl_alloc_obj(&t$kha_audio2_ogg_vorbis_Reader);
	r10 = hl_alloc_enum(&t$ctx_8d10a28,0);
	((Enumt$ctx_8d10a28*)r10)->p0 = (venum*)r7;
	((Enumt$ctx_8d10a28*)r10)->p1 = (vclosure*)r6;
	r9 = hl_alloc_closure_ptr(&t$fun_27a3c24,kha_audio2_ogg_vorbis_Reader_openFromFile__$1,r10);
	if( r5 == NULL ) hl_null_access();
	r11 = hl_vfields(r5)[9] ? (*(int*)(hl_vfields(r5)[9])) : (int)hl_dyn_geti(r5->value,206807499/*size*/,&t$_i32);
	kha_audio2_ogg_vorbis_Reader_new(r8,((haxe__io__Input)r1),r9,r11);
	return r8;
}

void kha_audio2_ogg_vorbis_Reader_readAll__$1(haxe__io__BytesInput r0,int r1) {
	kha_audio2_ogg_vorbis_Reader_seekBytes(r0,r1);
	return;
}

kha__audio2__ogg__vorbis__data__Header kha_audio2_ogg_vorbis_Reader_readAll(haxe__io__Bytes r0,haxe__io__Output r1,bool* r2) {
	kha__audio2__ogg__vorbis__VorbisDecoder r8;
	haxe__io__BytesInput r4;
	bool r3, r20;
	kha__audio2__ogg__vorbis__data__Header r11, r15;
	float r23;
	kha__arrays__Float32ArrayPrivate r16, r17;
	double r24;
	vclosure *r9;
	vdynamic *r5, *r6;
	vbyte *r19;
	int r10, r12, r13, r14, r18, r21, r22;
	if( r2 ) goto label$fec0647_15_3;
	r3 = false;
	goto label$fec0647_15_4;
	label$fec0647_15_3:
	r3 = *r2;
	label$fec0647_15_4:
	r4 = (haxe__io__BytesInput)hl_alloc_obj(&t$haxe_io_BytesInput);
	r5 = NULL;
	r6 = NULL;
	haxe_io_BytesInput_new(r4,r0,r5,r6);
	r8 = kha_audio2_ogg_vorbis_VorbisDecoder_start(((haxe__io__Input)r4));
	if( r8 == NULL ) hl_null_access();
	r9 = hl_alloc_closure_ptr(&t$fun_d8cbd66,kha_audio2_ogg_vorbis_Reader_readAll__$1,r4);
	if( r0 == NULL ) hl_null_access();
	r10 = r0->length;
	kha_audio2_ogg_vorbis_VorbisDecoder_setupSampleNumber(r8,r9,r10);
	r11 = r8->header;
	r10 = 0;
	r12 = 4096;
	if( r11 == NULL ) hl_null_access();
	r14 = r11->channel;
	r13 = r12 * r14;
	r16 = (kha__arrays__Float32ArrayPrivate)hl_alloc_obj(&t$kha_arrays_Float32ArrayPrivate);
	kha_arrays_Float32ArrayPrivate_new(r16);
	r16->length = r13;
	r18 = 0;
	if( r18 >= r13 ) goto label$fec0647_15_27;
	r19 = hl_kore_float32array_alloc(r13);
	r16->self = r19;
	label$fec0647_15_27:
	r17 = r16;
	label$fec0647_15_28:
	r20 = true;
	if( !r20 ) goto label$fec0647_15_56;
	if( r8 == NULL ) hl_null_access();
	if( r11 == NULL ) hl_null_access();
	r18 = r11->channel;
	r21 = r11->sampleRate;
	r14 = kha_audio2_ogg_vorbis_VorbisDecoder_read(r8,r17,r12,r18,r21,r3);
	r18 = 0;
	r22 = r11->channel;
	r21 = r14 * r22;
	label$fec0647_15_39:
	if( r18 >= r21 ) goto label$fec0647_15_50;
	r22 = r18;
	++r18;
	if( r1 == NULL ) hl_null_access();
	if( r17 == NULL ) hl_null_access();
	r19 = r17->self;
	r23 = hl_kore_float32array_get(r19,r22);
	r24 = (double)r23;
	haxe_io_Output_writeFloat(r1,r24);
	goto label$fec0647_15_39;
	label$fec0647_15_50:
	r21 = 0;
	if( r14 != r21 ) goto label$fec0647_15_53;
	goto label$fec0647_15_56;
	label$fec0647_15_53:
	r18 = r10 + r14;
	r10 = r18;
	goto label$fec0647_15_28;
	label$fec0647_15_56:
	if( r8 == NULL ) hl_null_access();
	r15 = r8->header;
	return r15;
}

int kha_audio2_ogg_vorbis_Reader_read(kha__audio2__ogg__vorbis__Reader r0,kha__arrays__Float32ArrayPrivate r1,vdynamic* r2,vdynamic* r3,vdynamic* r4,bool* r5) {
	kha__audio2__ogg__vorbis__VorbisDecoder r8;
	bool r6;
	kha__audio2__ogg__vorbis__data__Header r12;
	vclosure *r9;
	vdynamic *r10;
	int r11, r13, r14;
	if( r5 ) goto label$fec0647_16_3;
	r6 = false;
	goto label$fec0647_16_4;
	label$fec0647_16_3:
	r6 = *r5;
	label$fec0647_16_4:
	r8 = r0->decoder;
	if( r8 == NULL ) hl_null_access();
	r9 = r0->seekFunc;
	kha_audio2_ogg_vorbis_VorbisDecoder_ensurePosition(r8,r9);
	if( r2 ) goto label$fec0647_16_13;
	r8 = r0->decoder;
	if( r8 == NULL ) hl_null_access();
	r10 = r8->totalSample;
	r2 = r10;
	label$fec0647_16_13:
	if( r3 ) goto label$fec0647_16_19;
	r12 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r12 == NULL ) hl_null_access();
	r11 = r12->channel;
	r10 = hl_alloc_dynamic(&t$_i32);
	r10->v.i = r11;
	r3 = r10;
	label$fec0647_16_19:
	if( r4 ) goto label$fec0647_16_25;
	r12 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r12 == NULL ) hl_null_access();
	r11 = r12->sampleRate;
	r10 = hl_alloc_dynamic(&t$_i32);
	r10->v.i = r11;
	r4 = r10;
	label$fec0647_16_25:
	r8 = r0->decoder;
	if( r8 == NULL ) hl_null_access();
	r11 = r2 ? r2->v.i : 0;
	r13 = r3 ? r3->v.i : 0;
	r14 = r4 ? r4->v.i : 0;
	r11 = kha_audio2_ogg_vorbis_VorbisDecoder_read(r8,r1,r11,r13,r14,r6);
	return r11;
}

kha__audio2__ogg__vorbis__Reader kha_audio2_ogg_vorbis_Reader_clone(kha__audio2__ogg__vorbis__Reader r0) {
	kha__audio2__ogg__vorbis__VorbisDecoder r6;
	kha__audio2__ogg__vorbis__Reader r3;
	vclosure *r4;
	kha__audio2__ogg__vorbis__$Reader r2;
	vdynamic *r1, *r7;
	int r5;
	r2 = (kha__audio2__ogg__vorbis__$Reader)g$_kha_audio2_ogg_vorbis_Reader;
	r1 = Type_createEmptyInstance(((hl__Class)r2));
	r3 = (kha__audio2__ogg__vorbis__Reader)hl_dyn_castp(&r1,&t$_dyn,&t$kha_audio2_ogg_vorbis_Reader);
	if( r3 == NULL ) hl_null_access();
	r4 = r0->seekFunc;
	r3->seekFunc = r4;
	r5 = r0->inputLength;
	r3->inputLength = r5;
	r6 = r0->decoder;
	if( r6 == NULL ) hl_null_access();
	r4 = r0->seekFunc;
	r6 = kha_audio2_ogg_vorbis_VorbisDecoder_clone(r6,r4);
	r3->decoder = r6;
	r7 = r0->loopStart;
	r3->loopStart = r7;
	r7 = r0->loopLength;
	r3->loopLength = r7;
	return r3;
}

double kha_audio2_ogg_vorbis_Reader_sampleToMillisecond(kha__audio2__ogg__vorbis__Reader r0,int r1) {
	kha__audio2__ogg__vorbis__data__Header r4;
	double r2, r5;
	int r3;
	r2 = (double)(unsigned)r1;
	r4 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r4 == NULL ) hl_null_access();
	r3 = r4->sampleRate;
	r5 = (double)(unsigned)r3;
	r2 = r2 / r5;
	r5 = 1000.;
	r2 = r2 * r5;
	return r2;
}

int kha_audio2_ogg_vorbis_Reader_millisecondToSample(kha__audio2__ogg__vorbis__Reader r0,double r1) {
	kha__audio2__ogg__vorbis__data__Header r4;
	double r3, r5, r6;
	int r2;
	r4 = kha_audio2_ogg_vorbis_Reader_get_header(r0);
	if( r4 == NULL ) hl_null_access();
	r2 = r4->sampleRate;
	r3 = (double)(unsigned)r2;
	r6 = 1000.;
	r5 = r1 / r6;
	r3 = r3 * r5;
	r2 = hl_math_floor(r3);
	return r2;
}

