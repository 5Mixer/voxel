// Generated by HLC 4.1.3 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <kha/graphics4/VertexBuffer.h>
#include <kha/graphics4/VertexStructure.h>
#include <kha/graphics4/VertexElement.h>
#include <hl/natives.h>
int kha_graphics4_VertexStructure_size(kha__graphics4__VertexStructure);
kha__graphics4__VertexElement kha_graphics4_VertexStructure_get(kha__graphics4__VertexStructure,int);
#include <kha/arrays/Float32ArrayPrivate.h>
extern hl_type t$kha_arrays_Float32ArrayPrivate;
void kha_arrays_Float32ArrayPrivate_new(kha__arrays__Float32ArrayPrivate);
int kha_graphics4_VertexBuffer_count(kha__graphics4__VertexBuffer);
int kha_graphics4_VertexBuffer_stride(kha__graphics4__VertexBuffer);
#include <kha/arrays/Int16ArrayPrivate.h>
extern hl_type t$kha_arrays_Int16ArrayPrivate;
void kha_arrays_Int16ArrayPrivate_new(kha__arrays__Int16ArrayPrivate);

void kha_graphics4_VertexBuffer_new(kha__graphics4__VertexBuffer r0,int r1,kha__graphics4__VertexStructure r2,int r3,int* r4,bool* r5) {
	String r18;
	bool r7, r9;
	kha__graphics4__VertexElement r16;
	vbyte *r8, *r17, *r20;
	int r6, r11, r12, r13, r14, r15, r19;
	if( r4 ) goto label$f040c4f_1_3;
	r6 = 0;
	goto label$f040c4f_1_4;
	label$f040c4f_1_3:
	r6 = *r4;
	label$f040c4f_1_4:
	if( r5 ) goto label$f040c4f_1_7;
	r7 = false;
	goto label$f040c4f_1_8;
	label$f040c4f_1_7:
	r7 = *r5;
	label$f040c4f_1_8:
	if( r2 == NULL ) hl_null_access();
	r9 = r2->instanced;
	r8 = hl_kore_create_vertexstructure(r9);
	r11 = 0;
	r12 = kha_graphics4_VertexStructure_size(r2);
	label$f040c4f_1_13:
	if( r11 >= r12 ) goto label$f040c4f_1_55;
	r13 = r11;
	++r11;
	r14 = 0;
	if( r2 == NULL ) hl_null_access();
	r16 = kha_graphics4_VertexStructure_get(r2,r13);
	if( r16 == NULL ) hl_null_access();
	r15 = r16->data;
	switch(r15) {
		default:
			goto label$f040c4f_1_44;
		case 0:
			r15 = 1;
			r14 = r15;
			goto label$f040c4f_1_44;
		case 1:
			r15 = 2;
			r14 = r15;
			goto label$f040c4f_1_44;
		case 2:
			r15 = 3;
			r14 = r15;
			goto label$f040c4f_1_44;
		case 3:
			r15 = 4;
			r14 = r15;
			goto label$f040c4f_1_44;
		case 4:
			r15 = 5;
			r14 = r15;
			goto label$f040c4f_1_44;
		case 5:
			r15 = 6;
			r14 = r15;
			goto label$f040c4f_1_44;
		case 6:
			r15 = 7;
			r14 = r15;
	}
	label$f040c4f_1_44:
	r15 = 0;
	r16 = kha_graphics4_VertexStructure_get(r2,r13);
	if( r16 == NULL ) hl_null_access();
	r18 = r16->name;
	if( r18 == NULL ) hl_null_access();
	r17 = r18->bytes;
	r4 = &r15;
	r19 = 0;
	r20 = hl_utf16_to_utf8(r17,r19,r4);
	hl_kore_vertexstructure_add(r8,r20,r14);
	goto label$f040c4f_1_13;
	label$f040c4f_1_55:
	r17 = hl_kore_create_vertexbuffer(r1,r8,r3,r6);
	r0->_buffer = r17;
	return;
}

void kha_graphics4_VertexBuffer_delete(kha__graphics4__VertexBuffer r0) {
	vbyte *r2;
	r2 = r0->_buffer;
	hl_kore_delete_vertexbuffer(r2);
	return;
}

kha__arrays__Float32ArrayPrivate kha_graphics4_VertexBuffer_lock(kha__graphics4__VertexBuffer r0,vdynamic* r1,vdynamic* r2) {
	kha__arrays__Float32ArrayPrivate r5;
	double r9, r10;
	vbyte *r8;
	int r3, r6, r7, r11;
	r3 = 0;
	r5 = (kha__arrays__Float32ArrayPrivate)hl_alloc_obj(&t$kha_arrays_Float32ArrayPrivate);
	kha_arrays_Float32ArrayPrivate_new(r5);
	r5->length = r3;
	r7 = 0;
	if( r7 >= r3 ) goto label$f040c4f_3_8;
	r8 = hl_kore_float32array_alloc(r3);
	r5->self = r8;
	label$f040c4f_3_8:
	r8 = r0->_buffer;
	r8 = hl_kore_vertexbuffer_lock(r8);
	r6 = kha_graphics4_VertexBuffer_count(r0);
	r7 = kha_graphics4_VertexBuffer_stride(r0);
	r9 = (double)r7;
	r10 = 4.;
	r9 = r9 / r10;
	r11 = (int)r9;
	r7 = r6 * r11;
	r5->self = r8;
	r5->length = r7;
	return r5;
}

kha__arrays__Int16ArrayPrivate kha_graphics4_VertexBuffer_lockInt16(kha__graphics4__VertexBuffer r0,vdynamic* r1,vdynamic* r2) {
	kha__arrays__Int16ArrayPrivate r5;
	double r9, r10;
	vbyte *r8;
	int r3, r6, r7, r11;
	r3 = 0;
	r5 = (kha__arrays__Int16ArrayPrivate)hl_alloc_obj(&t$kha_arrays_Int16ArrayPrivate);
	kha_arrays_Int16ArrayPrivate_new(r5);
	r5->length = r3;
	r7 = 0;
	if( r7 >= r3 ) goto label$f040c4f_4_8;
	r8 = hl_kore_int16array_alloc(r3);
	r5->self = r8;
	label$f040c4f_4_8:
	r8 = r0->_buffer;
	r8 = hl_kore_vertexbuffer_lock(r8);
	r6 = kha_graphics4_VertexBuffer_count(r0);
	r7 = kha_graphics4_VertexBuffer_stride(r0);
	r9 = (double)r7;
	r10 = 2.;
	r9 = r9 / r10;
	r11 = (int)r9;
	r7 = r6 * r11;
	r5->self = r8;
	r5->length = r7;
	return r5;
}

void kha_graphics4_VertexBuffer_unlock(kha__graphics4__VertexBuffer r0,vdynamic* r1) {
	int r4;
	vbyte *r3;
	r3 = r0->_buffer;
	if( r1 ) goto label$f040c4f_5_4;
	r4 = kha_graphics4_VertexBuffer_count(r0);
	goto label$f040c4f_5_5;
	label$f040c4f_5_4:
	r4 = r1 ? r1->v.i : 0;
	label$f040c4f_5_5:
	hl_kore_vertexbuffer_unlock(r3,r4);
	return;
}

int kha_graphics4_VertexBuffer_stride(kha__graphics4__VertexBuffer r0) {
	vbyte *r2;
	int r1;
	r2 = r0->_buffer;
	r1 = hl_kore_vertexbuffer_stride(r2);
	return r1;
}

int kha_graphics4_VertexBuffer_count(kha__graphics4__VertexBuffer r0) {
	vbyte *r2;
	int r1;
	r2 = r0->_buffer;
	r1 = hl_kore_vertexbuffer_count(r2);
	return r1;
}

